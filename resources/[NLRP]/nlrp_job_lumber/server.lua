local treeHP = {}
local trees = {}
local logs = {}

local treePositions = {
	{ -1209.0270996094, -1157.822265625, 129.21875 },
	{ -1199.59765625, -1163.8439941406, 129.21875 },
	{ -1188.568359375, -1157.0770263672, 129.21875 },
	{ -1181.0802001953, -1156.1964111328, 129.21875 },
	{ -1171.4584960938, -1154.5328369141, 129.21875 },
	{ -1167.5964355469, -1163.5960693359, 129.21875 },
	{ -1158.3740234375, -1160.5069580078, 129.21875 },
	{ -1173.4790039063, -1168.5610351563, 129.21875 },
	{ -1182.1796875, -1173.056640625, 129.21875 },
	{ -1193.8894042969, -1169.11328125, 129.21875 },
	{ -1198.6019287109, -1173.9620361328, 129.21875 },
	{ -1203.7856445313, -1170.0001220703, 129.21875 },
	{ -1213.2559814453, -1175.4600830078, 129.21875 },
	{ -1201.2026367188, -1186.6804199219, 129.21875 },
	{ -1211.4572753906, -1186.8680419922, 129.21875 },
	{ -1199.8946533203, -1195.0736083984, 129.21875 },
	{ -1207.0494384766, -1202.2303466797, 129.21875 },
	{ -1208.7014160156, -1214.1767578125, 129.21875 },
	{ -1197.9948730469, -1215.1905517578, 129.21875 },
	{ -1193.8253173828, -1208.7337646484, 129.21875 },
	{ -1189.5844726563, -1196.0931396484, 129.21875 },
	{ -1190.2166748047, -1186.1301269531, 129.21875 },
	{ -1184.1590576172, -1180.5838623047, 129.21875 },
	{ -1177.4724121094, -1182.8708496094, 129.21875 },
	{ -1170.5678710938, -1175.5895996094, 129.21875 },
	{ -1161.0290527344, -1171.6520996094, 129.21875 },
	{ -1150.7785644531, -1160.9538574219, 129.21875 },
	{ -1162.1516113281, -1182.3289794922, 129.21875 },
	{ -1170.6166992188, -1189.4416503906, 129.21875 },
	{ -1179.2012939453, -1198.2430419922, 129.21875 },
	{ -1175.7653808594, -1203.7998046875, 129.21875 },
	{ -1178.4599609375, -1212.625, 129.21875 },
	{ -1170.7239990234, -1215.0145263672, 129.21875 },
	{ -1165.2495117188, -1209.3175048828, 129.21875 },
	{ -1161.8414306641, -1198.9910888672, 129.21875 },
	{ -1153.5911865234, -1176.8004150391, 129.21875 },
	{ -1153.7430419922, -1186.4224853516, 129.21875 },
	{ -1153.4354248047, -1204.5124511719, 129.21875 },
	{ -1141.2004394531, -1213.8690185547, 129.21875 },
	{ -1135.2387695313, -1209.1231689453, 129.21875 },
	{ -1139.9703369141, -1198.2059326172, 129.21875 },
	{ -1145.7587890625, -1194.2828369141, 129.21875 },
	{ -1145.3093261719, -1184.3127441406, 129.21875 },
	{ -1144.4942626953, -1171.7841796875, 129.21875 },
	{ -1136.9405517578, -1162.880859375, 129.21875 },
	{ -1137.0285644531, -1170.8103027344, 129.21875 },
	{ -1134.4222412109, -1183.8963623047, 129.21875 },
	{ -1128.6318359375, -1159.0007324219, 129.21875 },
	{ -1125.8887939453, -1171.646484375, 129.21875 },
	{ -1128.9112548828, -1191.6215820313, 129.21875 },
	{ -1124.99609375, -1214.6019287109, 129.21875 },
	{ -1120.1826171875, -1203.8887939453, 129.21875 },
	{ -1117.5395507813, -1187.6153564453, 129.21875 },
	{ -1113.5006103516, -1161.1279296875, 129.21875 },
	{ -1105.9031982422, -1155.91015625, 129.21875 },
	{ -1100.4354248047, -1163.6120605469, 129.21875 },
	{ -1103.3522949219, -1179.7487792969, 129.21875 },
	{ -1094.2893066406, -1180.8687744141, 129.21875 },
	{ -1092.8449707031, -1196.2945556641, 129.21875 },
	{ -1103.3029785156, -1205.7286376953, 129.2258605957 },
	{ -1091.5876464844, -1215.2849121094, 129.21875 },
	{ -1102.7611083984, -1224.2650146484, 129.21875 },
	{ -1114.4097900391, -1226.7998046875, 129.21875 },
	{ -1099.8336181641, -1235.5473632813, 129.21875 },
	{ -1112.6075439453, -1247.5913085938, 129.21875 },
	{ -1112.3883056641, -1261.0942382813, 129.21875 },
	{ -1104.4884033203, -1263.2259521484, 129.21875 },
	{ -1087.1925048828, -1260.8317871094, 129.21875 },
	{ -1078.4685058594, -1266.3084716797, 129.21875 },
	{ -1069.7960205078, -1279.9884033203, 129.21875 },
	{ -1081.0050048828, -1285.2310791016, 129.21875 },
	{ -1098.0875244141, -1284.8981933594, 129.21875 },
	{ -1114.4520263672, -1282.8395996094, 129.21875 },
	{ -1111.7457275391, -1275.8072509766, 129.21875 },
	{ -1195.5842285156, -1065.0572509766, 129.21875 },
	{ -1190.8117675781, -1050.2438964844, 129.21875 },
	{ -1176.5247802734, -1053.7290039063, 129.21875 },
	{ -1165.0726318359, -1057.9969482422, 129.21875 },
	{ -1159.8721923828, -1050.6492919922, 129.21875 },
	{ -1160.5743408203, -1043.7906494141, 129.21875 },
	{ -1171.1160888672, -1037.1223144531, 129.21875 },
	{ -1183.0102539063, -1034.3537597656, 129.21875 },
	{ -1192.4385986328, -1032.4912109375, 129.21875 },
	{ -1186.7824707031, -1021.4392700195, 129.21875 },
	{ -1193.6335449219, -1010.2448730469, 129.21875 },
	{ -1185.1501464844, -1008.7815551758, 129.21875 },
	{ -1178.2796630859, -1014.0739746094, 129.21875 },
	{ -1169.4007568359, -1022.4570922852, 129.21875 },
	{ -1158.4025878906, -1031.6602783203, 129.21875 },
	{ -1152.3387451172, -1041.7233886719, 129.21875 },
	{ -1144.9187011719, -1058.4334716797, 129.21875 },
	{ -1137.7799072266, -1052.4133300781, 129.21875 },
	{ -1136.2698974609, -1045.4841308594, 129.21875 },
	{ -1139.0828857422, -1035.2810058594, 129.21875 },
	{ -1141.9365234375, -1026.3977050781, 129.21875 },
	{ -1148.4473876953, -1011.3819580078, 129.21875 },
	{ -1155.5378417969, -1011.2932128906, 129.21875 },
	{ -1163.4729003906, -1009.775390625, 129.21875 },
	{ -1169.0194091797, -1004.5089111328, 129.21875 },
	{ -1177.0407714844, -1000.8455200195, 129.21875 },
	{ -1185.0225830078, -997.93365478516, 129.21875 },
	{ -1192.5054931641, -992.66143798828, 129.21875 },
	{ -1183.6827392578, -983.96710205078, 129.21875 },
	{ -1175.5493164063, -983.67858886719, 129.21875 },
	{ -1165.7159423828, -992.69500732422, 129.21875 },
	{ -1155.4412841797, -994.61602783203, 129.21875 },
	{ -1142.2049560547, -1002.8929443359, 129.21875 },
	{ -1136.5009765625, -1010.7549438477, 129.21875 },
	{ -1132.392578125, -1018.2048950195, 129.21875 },
	{ -1129.6978759766, -1029.9565429688, 129.21875 },
	{ -1127.9982910156, -1041.7674560547, 129.21875 },
	{ -1120.5616455078, -1052.0526123047, 129.21875 },
	{ -1114.56640625, -1048.6702880859, 129.21875 },
	{ -1111.7780761719, -1041.2414550781, 129.21192932129 },
	{ -1112.7712402344, -1030.0677490234, 129.21875 },
	{ -1110.3359375, -1021.1468505859, 129.21875 },
	{ -1114.9797363281, -1013.9940795898, 129.21875 },
	{ -1116.3756103516, -1007.8330688477, 129.21875 },
	{ -1122.6221923828, -1002.326171875, 129.21875 },
	{ -1131.2780761719, -995.62866210938, 129.21875 },
	{ -1140.3985595703, -990.03149414063, 129.21875 },
	{ -1152.283203125, -983.77587890625, 129.21875 },
	{ -1166.1096191406, -979.06536865234, 129.21875 },
	{ -1186.326171875, -978.20635986328, 129.21875 },
	{ -1190.3283691406, -968.44018554688, 129.21192932129 },
	{ -1181.9155273438, -967.14605712891, 129.21192932129 },
	{ -1167.3416748047, -968.75012207031, 129.21192932129 },
	{ -1153.5274658203, -972.10845947266, 129.21875 },
	{ -1140.8541259766, -977.25445556641, 129.21875 },
	{ -1127.2977294922, -987.49877929688, 129.21875 },
	{ -1114.5797119141, -997.65490722656, 129.21875 },
	{ -1112.7155761719, -989.68420410156, 129.21875 },
	{ -1117.7683105469, -976.65496826172, 129.21875 },
	{ -1126.8314208984, -971.13537597656, 129.21875 },
	{ -1134.7911376953, -967.84674072266, 129.21875 },
	{ -1160.1683349609, -980.47631835938, 129.21875 },
	{ -1144.0155029297, -957.64605712891, 129.21875 },
	{ -1148.0720214844, -954.12591552734, 129.21875 },
	{ -1162.0561523438, -956.85546875, 129.21875 },
	{ -1170.3498535156, -952.20446777344, 129.21875 },
	{ -1183.9095458984, -954.0654296875, 129.21192932129 },
	{ -1189.2829589844, -951.68310546875, 129.21192932129 },
	{ -1191.1979980469, -943.39154052734, 129.21192932129 },
	{ -1188.3103027344, -934.61804199219, 129.21192932129 },
	{ -1192.5491943359, -926.93304443359, 129.17881774902 },
	{ -1195.6737060547, -917.61120605469, 128.95556640625 },
	{ -1205.1977539063, -915.07629394531, 129.0339050293 },
	{ -1218.3248291016, -910.59918212891, 129.16725158691 },
	{ -1180.4475097656, -915.99725341797, 129.21875 },
	{ -1176.4245605469, -922.60809326172, 129.21192932129 },
	{ -1162.8173828125, -919.17620849609, 129.21875 },
	{ -1155.8280029297, -933.86975097656, 129.21875 },
	{ -1151.7507324219, -943.23883056641, 129.21875 },
	{ -1137.9940185547, -950.90460205078, 129.21875 },
	{ -1130.9090576172, -944.90716552734, 129.21875 },
	{ -1125.1115722656, -923.46820068359, 129.21875 },
	{ -1122.9407958984, -936.12091064453, 129.21875 },
	{ -1120.6578369141, -950.93890380859, 129.21875 },
	{ -1116.9849853516, -962.37615966797, 129.21875 },
	{ -1137.5003662109, -928.72119140625, 129.21875 },
	{ -1145.8315429688, -929.15496826172, 129.21875 },
	{ -1127.9908447266, -932.25634765625, 129.21875 },
	{ -1118.3588867188, -922.52478027344, 129.21875 },
	{ -1115.9426269531, -913.07434082031, 129.21875 },
	{ -1110.6949462891, -931.19366455078, 129.21875 },
	{ -1108.7191162109, -944.29705810547, 129.21875 },
	{ -1106.0286865234, -957.11273193359, 129.21875 },
	{ -1107.9392089844, -963.61840820313, 129.21875 },
	{ -1105.4460449219, -973.93353271484, 129.21875 },
	{ -1107.0954589844, -985.6875, 129.21875 },
	{ -1104.5157470703, -998.56964111328, 129.21875 },
	{ -1099.9768066406, -1019.2802734375, 129.21875 },
	{ -1100.4291992188, -1033.3013916016, 129.21875 },
	{ -1103.8873291016, -1043.7424316406, 129.21192932129 },
	{ -1112.0960693359, -1056.8620605469, 129.21875 },
	{ -1096.7377929688, -1060.8897705078, 129.21192932129 },
	{ -1092.1821289063, -1053.1342773438, 129.21192932129 },
	{ -1089.8232421875, -1038.8587646484, 129.21875 },
	{ -1082.27734375, -1023.7183227539, 129.21875 },
	{ -1086.4382324219, -1007.5764770508, 129.21875 },
	{ -1088.8775634766, -990.931640625, 129.21875 },
	{ -1092.7811279297, -975.90045166016, 129.21875 },
	{ -1089.6485595703, -962.04919433594, 129.21875 },
	{ -1093.7014160156, -952.83264160156, 129.21875 },
	{ -1092.1778564453, -944.1708984375, 129.21875 },
	{ -1101.6468505859, -925.58770751953, 129.21875 },
	{ -1103.8852539063, -916.85223388672, 129.21875 },
	{ -1100.2377929688, -941.58813476563, 129.21875 },
	{ -1089.2315673828, -919.69567871094, 129.21875 },
	{ -1081.564453125, -925.74737548828, 129.21875 },
	{ -1080.7283935547, -937.05004882813, 129.21875 },
	{ -1079.0946044922, -952.96612548828, 129.21875 },
	{ -1079.4541015625, -969.26336669922, 129.21875 },
	{ -1079.51171875, -982.82574462891, 129.21875 },
	{ -1076.7791748047, -1003.8944702148, 129.21875 },
	{ -1074.4510498047, -1020.1290893555, 129.21875 },
	{ -1074.2337646484, -1036.2327880859, 129.21875 },
	{ -1074.3356933594, -1056.7666015625, 129.21192932129 },
	{ -1058.8685302734, -1059.7562255859, 129.21192932129 },
	{ -1060.0825195313, -1048.3160400391, 129.21192932129 },
	{ -1058.0903320313, -1039.5036621094, 129.21875 },
	{ -1062.5321044922, -1028.8117675781, 129.21192932129 },
	{ -1058.0344238281, -1018.6654052734, 129.21192932129 },
	{ -1060.7132568359, -1006.72265625, 129.21192932129 },
	{ -1055.8258056641, -996.06866455078, 129.21875 },
	{ -1059.9768066406, -980.27783203125, 129.21875 },
	{ -1062.9639892578, -967.90924072266, 129.21875 },
	{ -1065.8742675781, -951.15759277344, 129.21875 },
	{ -1068.240234375, -938.44964599609, 129.21875 },
	{ -1067.3758544922, -929.52075195313, 129.21875 },
	{ -1071.75390625, -920.18267822266, 129.21875 },
	{ -1061.9202880859, -919.12561035156, 129.21875 },
	{ -1058.0223388672, -926.47729492188, 129.21875 },
	{ -1057.1340332031, -939.33392333984, 129.21875 },
	{ -1053.7795410156, -957.01580810547, 129.21875 },
	{ -1051.4713134766, -971.54498291016, 129.21875 },
	{ -1049.6416015625, -991.89733886719, 129.21875 },
	{ -1048.7895507813, -1010.4204101563, 129.21192932129 },
	{ -1048.6451416016, -1019.6772460938, 129.21192932129 },
	{ -1043.5344238281, -1042.1860351563, 129.21875 },
	{ -1046.7995605469, -1053.6760253906, 129.21192932129 },
	{ -1037.4516601563, -1059.5034179688, 129.21192932129 },
	{ -1026.0457763672, -1059.4735107422, 129.21875 },
	{ -1015.7123413086, -1054.7904052734, 129.21875 },
	{ -1012.864074707, -1046.927734375, 129.21875 },
	{ -1018.4370727539, -1037.6098632813, 129.21875 },
	{ -1029.7122802734, -1034.1427001953, 129.21875 },
	{ -1027.7370605469, -1023.278137207, 129.21875 },
	{ -1016.8131103516, -1020.1270751953, 129.21260070801 },
	{ -1009.0942382813, -1018.6371459961, 129.21260070801 },
	{ -1007.6417236328, -1006.9413452148, 129.21260070801 },
	{ -1022.0635375977, -999.08099365234, 129.21264648438 },
	{ -1035.806640625, -1000.5106201172, 129.21875 },
	{ -1026.7453613281, -991.17669677734, 129.21264648438 },
	{ -1011.8290405273, -988.90277099609, 129.21875 },
	{ -1005.3803100586, -979.31024169922, 129.21875 },
	{ -1016.4022216797, -977.40032958984, 129.21875 },
	{ -1033.8930664063, -981.54388427734, 129.21875 },
	{ -1040.0969238281, -968.46331787109, 129.21875 },
	{ -1029.8088378906, -967.32232666016, 129.21875 },
	{ -1009.8134155273, -964.00213623047, 129.21875 },
	{ -1010.6420288086, -951.96301269531, 129.21875 },
	{ -1022.6687011719, -952.22613525391, 129.21875 },
	{ -1034.4428710938, -953.05718994141, 129.21875 },
	{ -1037.2987060547, -942.23583984375, 129.21875 },
	{ -1045.1027832031, -926.39385986328, 129.21875 },
	{ -1048.7996826172, -917.46600341797, 129.21875 },
	{ -1034.4449462891, -919.98376464844, 129.21875 },
	{ -1022.623840332, -931.80096435547, 129.21875 },
	{ -1012.5484619141, -932.64715576172, 129.21875 },
	{ -1010.0894165039, -919.45269775391, 129.21875 },
	{ -1044.9105224609, -1075.0440673828, 129.2258605957 },
	{ -1067.2819824219, -1094.0975341797, 129.21875 },
	{ -1079.9141845703, -1088.1447753906, 129.21875 },
	{ -1096.2803955078, -1092.9298095703, 129.21875 },
	{ -1123.5633544922, -1083.6641845703, 129.21875 },
	{ -1142.8022460938, -1084.9084472656, 129.21875 },
	{ -1148.3083496094, -1091.6608886719, 129.21875 },
	{ -1133.9688720703, -1105.0889892578, 129.21875 },
	{ -1151.1722412109, -1099.4556884766, 129.21875 },
	{ -1164.8646240234, -1085.3725585938, 129.21875 },
	{ -1194.8015136719, -1084.4711914063, 129.21875 },
	{ -1195.8018798828, -1097.9516601563, 129.21875 },
	{ -1174.0826416016, -1137.6413574219, 129.21875 },
	{ -1151.9949951172, -1128.1676025391, 129.21875 },
	{ -1122.7366943359, -1131.9897460938, 129.2258605957 },
	{ -1097.8663330078, -1144.86328125, 129.21875 },
	{ -1072.791015625, -1131.3343505859, 129.21875 },
	{ -1062.1420898438, -1139.2120361328, 129.21875 },
	{ -1033.1926269531, -1141.0133056641, 129.21875 },
	{ -1038.9245605469, -1135.3778076172, 129.21260070801 },
	{ -1036.2564697266, -1109.7524414063, 129.21875 }
}

local eventsPrefix = "fa_"

addEvent(eventsPrefix .. "tryToCreateVehicle",true)
addEventHandler(eventsPrefix .. "tryToCreateVehicle",getRootElement(),
	function(hitElement)
		theVehicle = createVehicle (422, -1582.5498046875, -2715.197265625, 48.5390625, 0, 0, 90)
		warpPedIntoVehicle (hitElement, theVehicle)
		--triggerClientEvent(source,eventsPrefix.."initializeJob",source)
		setElementData(source,"onJobCar",true)
	end
)

addEvent("processUnusedVehicles",true)
addEventHandler("processUnusedVehicles",getRootElement(),
	function()
		if getElementData(source, "job") == 7 then
			destroyElement(theVehicle)
		end
	end
)

--local workBlip = {}

local startHP = 4000

local workMarker = createMarker(-2018.4837646484, -2399.6462402344, 29, "cylinder", 4.0, 183, 255, 0, 55)
local currency = math.random(15000,30000)
 
addEventHandler("onResourceStart", getResourceRootElement(), 
	function()
		favagoBlip = createBlip(workBlip[1], workBlip[2], workBlip[3], 11)
	end
)
	

 
function onMarkerHit(hitElement, matchingDimension)
	if source == workMarker and getElementType(hitElement) == "player" then
		local vehicle = getPedOccupiedVehicle(hitElement)

		if vehicle and isElement(vehicle) and getElementModel(vehicle) == 422 and getPedOccupiedVehicleSeat(hitElement) == 0 then
			local piles = getElementData(vehicle, "piles")
			if piles >= 1 then
				--outputChatBox( piles * currency .. "Ft-ot kerestél!", hitElement, 183,255,0)
				exports.nlrp_alert:showAlert(hitElement, "info", "Sikeresen leadtad a kivágott fákat.", "Összessen " .. piles * currency .. " Ft-ot kaptál értük")
				exports.nlrp_core:giveMoney(hitElement, piles * currency )
			else
				--outputChatBox("[NextLevel - Lumberjack]: Nincs a kocsidon fa!", hitElement, 255,70,70)
				exports.nlrp_alert:showAlert(hitElement, "warning", "Nincs a kocsidon fa!")
			end
			for pile = 1, piles do
				destroyElement(getElementData(vehicle, "pile" .. pile))
			end
			
			setElementData(vehicle, "piles", 0)
		end
	end
end
addEventHandler("onMarkerHit", getRootElement(), onMarkerHit)

function getDegreesBetweenPositions(x, y, x2, y2)
	dX = x2 - x
	
	dY = y2 - y

	angle = math.atan2(dY, dX)

	angle = math.deg(angle)

	angle = angle + 180
	
	return angle
end

function syncTreeDestroy(target)
	if isElement(target) then
		local treeID = getElementData(target, "treeID")

		local treeX, treeY, treeZ = getElementPosition(target)

		local cornerX, cornerY = treeX, treeY
		local pointX, pointY = treeX + 3.25, treeY

		z = getElementData(target, "rotX")
		local angle = math.rad(z)

		local rotatedX = math.cos(angle) * (pointX - cornerX) - math.sin(angle) * (pointY- cornerY) + cornerX;
		local rotatedY = math.sin(angle) * (pointX - cornerX) + math.cos(angle) * (pointY - cornerY) + cornerY;

		destroyElement(target)

		logs[treeID] = createObject(684, rotatedX, rotatedY, treeZ)
		setElementRotation(logs[treeID], 0, 0, z + 90)
		setElementData(logs[treeID], "log", true)
		setElementData(logs[treeID], "treeID", treeID)
		setElementData(logs[treeID], "HP", 6)
	end
end
addEvent("syncTreeDestroy", true)
addEventHandler("syncTreeDestroy", getRootElement(), syncTreeDestroy)

function syncLogDestroy(target)
	destroyElement(target)
end
addEvent("syncLogDestroy", true)
addEventHandler("syncLogDestroy", getRootElement(), syncLogDestroy)


function createTree()
	for k, v in ipairs(treePositions) do
		if not isElement(trees[k]) then
			local rotation = math.random(1, 360)

			trees[k] = createObject(617, v[1], v[2], v[3] - 1)

			--outputChatBox(v[1])

			setElementRotation(trees[k], 0, 0, rotation)
			setElementData(trees[k], "rotX", rotation)
			setElementData(trees[k], "tree", true)
			setElementData(trees[k], "treeID", k)
			setElementData(trees[k], "HP", startHP)
		end
	end
end
createTree()

setTimer(createTree, 60 * 60 * 1000, 0)

function syncSawing(treeID, start, fail)
	triggerClientEvent("syncSawing", getRootElement(), treeID, start, logs[treeID], fail)

	if start then
		setPedAnimation(client, "BOMBER", "BOM_Plant", 0, true, false, true, true)
	else
		--outputChatBox("stoppoljá")
		setPedAnimation(client)
	end
end
addEvent("syncSawing", true)
addEventHandler("syncSawing", getRootElement(), syncSawing)

function startCarry()
	if isElement(carryBox) then
		destroyElement(carryBox)
	end

	--outputChatBox("carrizzé")

	local x, y, z = getElementPosition(client)

	if isElement(getElementData(client, "carryObject")) then
		destroyElement(getElementData(client, "carryObject"))
	end

	local carryObject = createObject(1463, x, y, z, 0, 0, 0)
				
	setElementCollisionsEnabled(carryObject, false)

	setObjectScale(carryObject, 0.4)

	exports.nlrp_boneattach:attachElementToBone(carryObject, client, 12, 0.25, 0.05, 0.15, -90, 0, -20)

	setElementData(client, "carryObject", carryObject)
		
	toggleControl(client, "fire", false)
	toggleControl(client, "sprint", false)
	toggleControl(client, "crouch", false)
	toggleControl(client, "jump", false)

	setPedAnimation(client, "CARRY", "crry_prtial", 0, true, false, true, true)

	setElementData(client, "carry", true)
end
addEvent("startCarry", true)
addEventHandler("startCarry", getRootElement(), startCarry)

	--[[
	attachElements(vehicleObject, vehicle, -0.35, -0.8, -0.1)
	attachElements(vehicleObject2, vehicle, 0.35, -0.8, -0.1)
	attachElements(vehicleObject2, vehicle, 0, -1.5, -0.1)
	attachElements(vehicleObject3, vehicle, -0.35, -2.1, -0.1)
	attachElements(vehicleObject4, vehicle, 0.35, -2.1, -0.1)
	attachElements(vehicleObject5, vehicle, 0, -1.5, 0.15)
	]]

pilePositions = {
	{-0.35, -0.8, -0.1},
	{0.35, -0.8, -0.1},
	{0, -1.5, -0.1},
	{-0.35, -2.1, -0.1},
	{0.35, -2.1, -0.1},
	{0, -1.5, 0.15}
}

function stopCarry(vehicle)
	local piles = getElementData(vehicle, "piles")

	if not piles then
		piles = 0
	end

	piles = piles + 1
	
	setElementData(vehicle, "piles", piles)


	--if piles > 6 then
	--	outputChatBox("Hova akarod rakni, ha?")
	--else
		--outputChatBox("a")

		exports.nlrp_boneattach:detachElementFromBone(getElementData(client, "carryObject"))
		if destroyElement(getElementData(client, "carryObject")) then
			--outputChatBox("destroy")
		end

		setElementData(client, "carry", false)
		--setElementData(client, "carryObject", false)

		toggleControl(client, "fire", true)
		toggleControl(client, "sprint", true)
		toggleControl(client, "crouch", true)
		toggleControl(client, "jump", true)

		local vehicleX, vehicleY, vehicleZ = getElementPosition(vehicle)

		local x, y, z = getElementPosition(client)

		local rot = getDegreesBetweenPositions(x, y, vehicleX, vehicleY)

		setElementRotation(client, 0, 0, rot + 90)

		setPedAnimation(client, "CARRY", "putdwn05", -1, false, false, false, false)

		local vehicleObject = createObject(1463, x, y, z, 0, 0, 0)
		setElementCollisionsEnabled(vehicleObject, false)
		setObjectScale(vehicleObject, 0.4)

		attachElements(vehicleObject, vehicle, pilePositions[piles][1], pilePositions[piles][2], pilePositions[piles][3])

		setElementData(vehicle, "pile" .. piles, vehicleObject)

		--outputChatBox(piles)
	--end
end
addEvent("stopCarry", true)
addEventHandler("stopCarry", getRootElement(), stopCarry)